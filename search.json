[{"title":"如何优雅的抓包","date":"2022-09-08T13:31:07.000Z","url":"/2022/09/08/Socket/","tags":[["Socket","/tags/Socket/"]],"categories":[["计算机","/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"]],"content":"如何优雅的抓包目标：喜马拉雅FM 要求：获取软件的发送数据的端口和数据 环境：Kali Lunux&#x2F;Android 通过Objection定位关键位置$ objection -N -h 192.168.31.227 -g com.ximalaya.ting.android explore 首先通过以上命令进入objection交互界面，如图0-1所示 图0-1 现在需要找到所有和Socket有关的函数 $ android hooking search classes socket 搜索结果如图0-2所示 图0-2 ⚠注意： 在Objection中android hooking watch class 无法hook构造参数！需要手动修改 agent.js实现watch class的地方，然后添加$init来hook构造参数 将之前得到的搜索结果全部hook（这里可以通过保存hook搜索结果到文本，将文本每行前面加入 android hooking watch class用-c参数hook文本里所有函数 ），观察发送数据时那些函数被调用了 图0-3 打印可疑的函数的堆栈，发现java.net.SocketOutputStream.write(SocketOutputStream.java:161) 如图所示0-4 图0-4 通过查看Android源码SocketOutputStream.java:161发现write()函数又调用了socketWrite()函数 如图0-5所示 socketWrite(byte b[], int off, int len) byte b[]: 要写入的数据 int off: 数据中的起始偏移量 int len:被写入的字节数 图0-5 代码实现获取http responsehook java.net.SocketOutputStream.write() java.net.SocketOutputStream.read() 因为Socket是底层的二进制数据传输，hook了Socket，对上层应用绝大多数都逃不过，除非自定义协议。 获取https response"},{"title":"frida从入门到入门","date":"2022-08-19T16:44:36.000Z","url":"/2022/08/20/aaa/","tags":[["frida","/tags/frida/"],["hook","/tags/hook/"]],"categories":[["计算机","/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"]],"content":"入门Frida安装需要python环境pip install frida-tools 终端输入该命令即可完成安装 注入方式 frida -l xx.js 进程ID|进程名|-F 注入到现有进程（时机较晚） frida -l xx.js -f 文件目录 --no-pause 创建进程后注入（时机较早） 延迟注入可使用js代码实现 AndroidHook JavaHook java层首先需要被包裹在Java.perform(function()&#123;&#125;)中，当需要调用Java类时使用Java.use(&#39;类名&#39;)来调用其中$init表示构造函数，$new表示实例化对象.overload(&#39;type&#39;)表示重载函数成员方法和成员属性名字相同时默认hook成员方法，如需hook成员属性在成员属性前加“_”来表示 主动调用函数 静态调用 使用Java.use().class.implementation&#x3D;function(){hook代码} 动态调用 使用choose(class,callback)其中callback有两个属性 onMatch:function(instance),onMatch表示进入hook，instance表示在内存中找到的实例 onComplete:function()，表示完成hook hook参数&amp;返回值部分情况下直接打印返回值并不能直观的体现需要通过类型转换得到需要的数据，如DumpHex，可以通过$ClassName得到class的属性后在转换，如果为Json类的可以直接用JSON.Stringify()转换成字符串 hook被混淆的方法有些被混淆方法名可能是不可视的字符如༒如果以这个字符命名的函数是合法的但是又有可能因为字符集的原因看不到函数名，这就要将其编码打印出来再通过打印的字符来调用此方法 类型转换Java.cast（arg,type）强转类型 调用DEX类如果有现成的安卓源码可以将其编译后解压apk得到class.dex,使用Java.openClassFile(&#39;dex路径&#39;).lord()加载dex类 注册java类如果不想调用dex，可以将java代码翻译成js代码用 打印堆栈调用安卓自带的API实现打印堆栈 rpc远程调用frida支持在js代码中使用rpc.exports关键字对js函数进行导出，导出方法可在python代码中通过script.exports.导出符号()进行调用 通过python调用 Hook Nagtive判断指令集可以利用IDA 判断来Thumb指令集和Arm 指令集 IDA - Options - General - number of opcode bytes - 设置为 4 查看 IDA VIew 中 opcode 的长度, 如果出现 2 个字节和 4 个字节的, 说明为 thumb 指令集 如果都是 4 个字节的, 说明是 arm 指令集 在 Thumb 指令集下, inline hook 的偏移地址需要进行 +1 操作 hook so 函数hook so 函数首先需要知道该函数所在的内存地址，通过Module.findExportByName(moduleName|null, exportName)获取模块基址后加上偏移得到函数地址,用Interceptor.attrach(addr,callbcak)hook函数的返回值&amp;参数。callback有一下两个属性onEnter:function(arg)可以在这里修改arg参数的值onLeave:function(retvalue)在这里修改函数的返回值注意：需要用retvalue.replace()来修改返回值 将so函数注册到js中new Nativefunction(addr,retType,[argsType]) address : 函数地址 returnType : 指定返回类型 argTypes : 数组指定参数类型 类型可选: void, pointer, int, uint, long, ulong, char, uchar, float, double, int8, uint8, int16, int32, uint32, int64, uint64; 参照函数所需的 type 来定义即可;参数内容需要开辟空间，注意类型，若无参数argType填[]即可 Windowsobjection的使用objection实现Java层hook everywhere，内存漫游，内存搜索，来达到快速逆向的目的 objection -g [packageName] explore打开交互界面调试该应用 命令 说明 memory list modules 枚举当前进程模块 memory list exports [lib_name] 查看指定模块的导出函数 memory list exports libart.so –json &#x2F;root&#x2F;libart.json 将结果保存到json文件中 memory search –string –offsets-only 搜索内存 search instances search instances com.xx.xx.class 堆内存中搜索指定类的实例, 可以获取该类的实例id android heap execute [ins_id] [func_name] 直接调用指定实例下的方法 android heap execute [ins_id] 自定义frida脚本, 执行实例的方法 android root disable 尝试关闭app的root检测 android root simulate 尝试模拟root环境 android ui screenshot [image.png] 截图 android ui FLAG_SECURE false 设置FLAG_SECURE权限 android hooking list classes 列出内存中所有的类 android hooking search classes [search_name] 在内存中所有已加载的类中搜索包含特定关键词的类 android hooking search methods [search_name] 在内存中所有已加载的方法中搜索包含特定关键词的方法 android hooking generate simple [class_name] 生成hook代码 android hooking watch class_method com.xxx.xxx.methodName –dump-args –dump-backtrace –dump-return hook指定方法, 如果有重载会hook所有重载,如果有疑问可以看–dump-args : 打印参数–dump-backtrace : 打印调用栈–dump-return : 打印返回值 android hooking watch class com.xxx.xxx hook指定类, 会打印该类下的所有调用 android hooking set return_value com.xxx.xxx.methodName false 设置返回值(只支持bool类型) android hooking list activities 枚举activity android intent launch_activity [activity_class] 启动activity android hooking list services 枚举services android intent launch_service [services_class] 启动services jobs list 查看任务列表 job kill [id] 删除任务 android sslpinning disable 关闭ssl校验 help android clipboard 获取Android剪贴板服务上的句柄并每5秒轮询一次用于数据。 如果发现新数据，与之前的调查不同，则该数据将被转储到屏幕上。 help android shell_exec [command] 执行命令 frida-trace的使用frida－trace是一个动态跟踪函数调用的工具 frida进阶Stlkersocket"},{"title":"英语语法入门","date":"2022-07-15T04:00:00.000Z","url":"/2022/07/15/test/","tags":[["语法","/tags/%E8%AF%AD%E6%B3%95/"]],"categories":[["英语","/categories/%E8%8B%B1%E8%AF%AD/"]],"content":"组成成分主语什么是主语？句子主要说明的对象 什么可以做主语？ 名词&#x2F;代词 doing (动名词) to do 并列多个 从句（主语从句） 主语在简单句（一件事）中的位置？句首或句尾 主语 On the way,a young man waved to me. 先找到谓语动词，谓语动词前面就是主语后面是宾语表语 The instrument(仪器，乐器) was bought by my grandfather many years ago. I felt very nervous… Fishing(&#x3D;To Fish) is my favourite sport. Playing basketball is my favourite sport. Playing basketball with my friends is my favourite sport. Playing basketball with my best friends is my favourite sport. Playing basketball with my best friends happily is my favourite sport. Playing basketball with my best friends happily on the playground is my favourite sport. Playing basketball with my best friends happily on the playground on Mondays is my favourite sport. It is my favourite sport to play basketball with my best fridens happily on the playground on Mondays. It is(形式主语) my favourite sport to fish. It(形式主语) was his job to repair bicycles(真正的主语)（&#x3D;repairing bicycles）… And(连接词) placing(放在…) too much emphasis(强调) on their opinions can ruin a fantatic(&#x3D;every good) home purchase(购买).(2019，英语二,Reading comprehension,Part B) 情态动词 can + 原型 ruin是一个整体的 … to anticipate(预料到) every imaginable(想象中的) driving(开车) situation(状况) is a difficult programming problem.(2019,英语一,Reading comprehension,Part A Text 3) 谓语动词什么是谓语？说话的内容 什么是谓语动词？ 时态 情态 被动语态 否定 强调 谓语动词在简单句（一件事）中的位置？ 主语后面 一个句子中只能有一个谓语动词 谓语动词 At than time he had two helpers. Aeroplanes are slowly driving me mad. I have been offered(现在完成时的被动语态) a large sum of money to go away… The play may begin at any moment… I did not enjoy it. With other audiences you mustn’t attempt to cut in with humor…(2002,英语一,Reading Comperhension,Part A Text 1) Native U.S. workers won’t be returning to the farm.(2019,英语二,Reading Comperhension,Part A Text 3) 宾语什么是宾语？动作的承受者 什么可以做宾语？ 动宾 主语+谓语动词+宾语 名词&#x2F;代词 doing to do 并列多个 宾语从句 介宾 名词&#x2F;代词 doing 并列多个 从句 宾语 After so many years of sunshine,Harrison got a shock. Everybody knows him. I never enjoy meeting Nigel Dykes. I offen fish for hours without catching anything. Almost（几乎） immediately(立刻，马上) he began to complain about the weather… Then he lent me a book. Thinking is essentially a process of making connections in the brain.(2014,英语一,Use of English) Americans continue to prize many of the same traditional milestones of asuccessful life(2016,英语二,comprehension,Part A Text 4) 宾语在简单句（一件事）中的位置在动词后：动宾 在介词后：介宾 表语什么是表语？表述的内容 什么可以作表语？ 名词&#x2F;代词 doing to do 并列多个 表语从句 形容词&#x2F;副词 介词短语 表语在简单句（一件事）中的位置？系动词的后面 表语 This note is only a reminder. Traffic police are sometimes very polite. My brother has never been abroad before… He will be in his small boat ,Topsail. A short while ago,however,he became a bus driver… These purchases often become more valuable with time…(2014,英语二,Reading Comprehension,Part A Text 1) The trick is to direct these funds better.(2013,英语二,Reading Comprehension,Part B) 宾语补足语We make him happy 什么是宾补？补充说明宾语 什么可以做宾补？除了谓语动词，都可以作宾补 宾补判断宾补和双宾语：在两个词中间“+ 是”意思通顺的是宾补 … he is finding this trip very exciting. Do you call that a hat? Early next morning ,she heard planes passing overhead… Furthermore,these losses make us mature…(2015,英语二,Reading Comprehension,Part B) The spooks(间谍) call it “open source intelligence(情报),”…(2003,英语一,Reading Comprehension,Part A Text 1) 定语修饰名词叫做定语 什么是定语？修饰限定名词 定语在简单句（一件事）中的位置？名词前后 什么可以做定语？ 前置定语 形容词 名词 doing done 后置定语 介词短语 doing词组 done词组 to do(词组) 定语从句 定语 This is a private conversataion! …but Mr. Scott cannot get a telephone (目的状语)for his new(定语修饰garage) garage… Forest fires are often caused by broken glass or by cigarette ends… …passing planes can be heard night and day. A new machine cellde ‘The Revealer’ has been invebted… He never has anything to do. … renewable(可以更新的) energy is already a pincipal(主要的) energy source.（2018,英语二,Reading Comprehension, Part A Text 2） A team (of researchers) (working together in the laboratory) would submit the result of their research to a journal.(2008,英语一,Reading Comprehension,Part 1 Text 2) 状语什么是状语？除了修饰名词的都叫状语 状语在简单句（一件事）中的位置？修饰谁放谁旁边 什么可以作状语？状语 Postcards always spoil(毁坏) my holidays. Last Sunday(时间状语) I got up very late. Towards evening(时间状语), the boat struck a rock and the girl jumped into the sea（地点状语）. I sat(坐) (in the front of the bus)(地点状语) (to get a good view of the countryside)(目的状语). to do表目的 Looking round(方式状语), I realized that I was the only passenger… This temporarily(暂时地) lowers(降低) carbon-carrying（碳承载） capacity(能力)(2019,英语二,Reading Comprehension,Part A Text 2) To promote this idea, he turned to the university-admissions(记录) process.(2013,英语一,Use of English) 各种词性动词动词在句中可以作什么成分？谓语动词，非谓语动词 Lsat week I went to the theatre. I’m coming to see you. 实义动词及物动词.vt：主句表达不完整，需要加宾语 不及物动词.vi：主语表达完整，后面不需要加宾语，如要加宾语，必须在后面加某个介词 系动词前后联系 助动词帮助作用的动词 情态动词表示情绪，态度的动词 动词 These views of arguments also undermine(暗中破坏) reason.(2019,英语一,Reading Comprehension,Part B) Overtime is not attractive to this generation(2017,英语二,Reading Comprehension,Part B) 名词&#x2F;代词名词的作用是什么？表示一个东西或者一个人的名称 名词在句中可以作什么成分？ …the boys put up their tent in the middle of a field. 名词所有格是什么？怎么表示？&#39;s/&#39;: Tomorrow evening they will be singing at the Workers’ Club. It would strike twelve in twenty minutes’ time. 通常情况下加&#39;s如果单词后有s直接加&#39;即可 of: This time, she will be a girl of seventeen. Once he landed on the roof of a block of flats(公寓)… 区别：&#39;s/&#39;翻译为a的b，of翻译为b的a 代词 我 你 他&#x2F;她&#x2F;它 我们 你们 他们&#x2F;她们&#x2F;它们 人称代词（主格） I you he&#x2F;she&#x2F;it we you they 人称代词（宾格） me you him&#x2F;her&#x2F;it us you them 形容词性物主代词 my your his&#x2F;her&#x2F;its our your their 名词性物主代词 mine yours his&#x2F;hers&#x2F;its ours yours theirs 反身代词 myself yourself himself&#x2F;herself&#x2F;itself ourselves yourselves themselves 人称代词主格，位于谓语动词前，作主语。 He loves her very much. 人称代词宾格，位于及物动词后或介词前，作宾语d。 I would like to talk with them. 形容词性物主代词，相当于形容词用，后面必须接名词 I think this bag is your bag. 名词性物主代词，含义中已经包含名词，不能接名词 I think this bag is yours. 反身代词，表示“某人自己” He saw it himself. i said to myself that i had to work harder. 冠词&#x2F;数词冠词冠词的作用是什么？放在名词前面，对名词修饰限定 冠词分为几种？ 不定冠词 a&#x2F;an 泛指，后加单数可数名词 定冠词 the 特指，后加任意名词 零冠词 冠词 Yesterday a beggar knocked at my door. …the beggar stood on his head and sang songs. John lives in England&gt; He has a house in London. 数词数词分哪两类？ 基数词 序数词 基数词 序数词 1 one first 2 two second 3 three third 4 four fourth 5 five fifth 6 six sixth 7 seven seventh 8 eight eighth 9 nine ninth 10 ten tenth 11 eleven eleventh 12 twelve twelfth 13 thirteen thirteenth 20 twenty twentieth 如何表达分数？$ \\frac{基数词}{序数词} $超过1结尾加s 如何表达百分数？percent&#x3D;per cent By the third generation(代),one third of Hispanic women are married to non-Hispanics,and 41 percent of Asian-American women are maerried to non-asians.(2006,英语一,Reading Comprehension，Part A Text 1) 0,000,000,000,000 百：hundred 千：thousand 百万：million 十亿：billion 万亿：trillion 形容词&#x2F;副词形容词形容词修饰名词，副词修饰剩下的 形容词的作用是什么？修饰名词 形容词在句子中可以作什么成分？ We are now living in a beautiful new house in the country. The plane was late… 副词副词的作用是什么？主要修饰 动词，句子，形容词，其他副词 …it rained continually and it was often bitterly cold. However,they have decided to use post office. Happy people work differently.(2016,英语二,Use of English) …the mean of expression is purely and exclusively physical(有形的):sound.(2014,英语一,Translation) 介词介词的作用是什么？”接词“组成一个词组 介词能接什么构成介词短语？ 名词 代词 doing 介词 I looked at my watch. On Wednesday evening,we went to the Town Hall. One afternoon she set out from the coast in a small boat. Towards evening,the boat struck a rock and the girl jumped into the sea. A woman in jeans stood at the window of an expensive shop. The decision of the New York Philharmonic to hire Alan Gilbert（这里是非谓语） as its next music director has been the talk of the classical-music world ever since the sudden announcement of his appointment in 2009.(2011,英语一，Reading Comprehension,Part A Text1) in（静态） into（动态） 连词连词的作用是什么？前后连接词或句子 连接词主要分哪两类？ 并列连词（and，but，or，so…） 从属连词（if because when after…） 连词 I repeated my question several times and at last he understood. Then he spoken slowly, but I could not understand him. When the plane arrived,some of the detectives were waiting inside the main building… if you park your car in the wrong place, a traffic policeman will soon find it. …Captain Fawcett did not take him because the trip was too dangerous. Money may not quite buy happiness, but people in wealthier countries are generally happier than those in poor ones.(2014, 英语二, Reading Comprehension, Part A Text 1) Our legal system was designed to set law apart from politics (precisely because they are so closely tied).(2012,英语一,Use of English) "}]